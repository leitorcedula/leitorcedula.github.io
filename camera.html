<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      #webcam-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
      }

      #label-container {
        text-align: center;
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 24px;
        color: white;
      }
    </style>
    <title>App Leitor de Cédulas</title>
  </head>

  <body>
    <div id="webcam-container"></div>
    <div id="label-container">Leitor de Cédulas</div>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
      const constraints = {
        video: {
          facingMode: {
            exact: "environment", // Forçar o uso da câmera traseira
          },
        },
      };

      async function initCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          const videoElement = document.createElement("video");
          videoElement.srcObject = stream;
          videoElement.play();

          // Adicione o elemento de vídeo ao contêiner da webcam
          const webcamContainer = document.getElementById("webcam-container");
          webcamContainer.appendChild(videoElement);

          // Carregue o modelo de IA
          const URL = "URL_DO_SEU_MODELO"; // Substitua pelo URL do seu modelo de IA
          const modelURL = URL + "model.json";
          const metadataURL = URL + "metadata.json";
          const model = await tmImage.load(modelURL, metadataURL);

          // Lógica para usar o modelo com o vídeo
          setInterval(async () => {
            const prediction = await model.predict(videoElement);
            // Encontre a classe com maior probabilidade
            const maxPrediction = Math.max(...prediction.map(obj => obj.probability));
            const predictedClass = prediction.find(obj => obj.probability === maxPrediction).className;
            // Atualize o contêiner com a classe prevista
            document.getElementById("label-container").innerText = predictedClass;
          }, 1000); // Atualiza a IA a cada 1 segundo
        } catch (error) {
          console.error("Erro ao acessar a câmera: ", error);
        }
      }

      // Chame a função para inicializar a câmera e a IA
      initCamera();
    </script>
  </body>
</html>
